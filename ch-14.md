## monitoring and incident response

- incident response process
    - preparation -> detection -> analysis -> containment -> eradication -> recovery -> back to prep
    - preparation
        - build tools / processes / procedures to respond to an incident 
        - includes building and training a response team, conducting exercises, documenting responses, and acquiring, configuring, and operating security tools and incident response capabilities 
    - detection
        - review events to identify incidents 
        - look for indicators of compromise, log analysis, security monitoring, have an awareness and reporting program for staff
    - analysis
        - identify related events and their target / impact 
    - containment
        - incident response team needs to contain the incident to prevent further issues / damage
        - can involve quarantine 
    - eradication
        - removing artifacts associated with the incident
        - can involve rebuilding / restoring systems and applications from backups 
    - recovery
        - bringing systems / services back up 
        - implement fixes to ensure the incident won't happen again
        - lessons learned session
- preparing for incident response (IR)
    - incident response (IR) team 
        - teams typically include:
        - member of mgmt / org leadership 
            - makes decisions for the team, communicates with senior mgmt
        - infosec staff 
            - has IR and analysis skills 
        - technical experts
            - ex: sysadmins, devs
            - knowing systems, software, and architecture can help responders find artifacts
        - communications and PR staff 
        - legal and HR staff 
        - law enforcement (occasionally)
    - exercises
        - tabletop exercises
            - used to talk through processes 
            - given a scenario, answer questions about how they'd respond, what issues may arise, and what they need to do to accomplish their tasks 
            - members think through a scenario and document improvements in their responses and IR plan
        - simulations
            - can simulate individuals pieces of a plan or target specific parts of org 
            - or can be done at full scale 
    - building IR plans 
        - subplans include:
        - communication plans 
            - who makes final calls on communications? what roles do people have?
        - stakeholder management plans
            - related to comm plans and focus on ppl w/ interest or role in systems, orgs, or services impacted by the incident
            - stakeholders can be internal or external to org 
            - helps prioritize which stakeholders receive comms, what support they need, how they will interact w/ IR process 
        - business continuity (BC) plans
            - focus on keeping org functional after an incident 
            - used to ensure impacted systems or services can still function despite any changes from IR process 
                - ex: restore or offload services, using alternate systems 
        - disaster recovery (DR) plans 
            - define processes and procedures for when a disaster occurs 
            - DR plan focuses on natural and human made disasters that may destroy facilities / infra
            - focuses on restoration or continuation of services despite a disaster
    - policies
        - policy: formal statements about an org's intent
            - why does the org operate this way, define purpose / objective of an activity or program 
        - IR policies include:
            - team and authority the team operates under
            - the creation and maintenance of incident handling and response procedures and practices
            - defines overall IR process 
            - may have specific comm / compliance requirements 
    - training
        - IR certs, training for IR 
- threat hunting
    - common indicators of compromise (IoC)
        - account lockout 
            - often from brute force login attempts 
        - concurrent session usage
            - users connected from more than one system / device, esp when second device is in an unexpected location or the app isn't usually used on multiple devices at once 
        - blocked content
            - if user is accessing blocked content, it may be because a malicious actor is trying to access the resource
        - impossible travel 
            - user connecting from two locations that are impossible to travel to in that amt of time
        - resource consumption
            - filling up a disk or using more bandwidth than usual for uploads / downloads
        - resource inaccessibility
            - if a system / file / service isn't accessible, need to ensure the cause isn't malicious
        - out of cycle logging
            - when an event usually during x time happens at an unusual time 
            - ex: cleanup process activating at unusual time, user logging in at 2am
        - missing logs 
    - understanding attacks and incidents
        - MITRE ATT&CK
            - ATT&CK: adversarial tactics, techniques, & common knowledge 
            - https://attack.mitre.org
            - MITRE's knowledge base of adversary tactics and techniques
            - includes detailed descriptions, definitions, and examples for threat life cycle (reconnaissance, execution, persistence, privilege escalation, and impact)
- incident response data and tools
    - monitoring computing resources
        - systems monitoring
            - system logs
            - central management tools
                - can aggregate and analyze system health and performance info
        - application monitoring
            - application logs
            - application mgmt interfaces
            - performance monitoring tools 
        - infrastructure monitoring
            - devices generate logs (eg SNMP and syslog)
    - security information and event management systems (SIEMs)
        - collect and aggregate log data from a variety of sources, then correlate and analyze the data
        - also captures and analyzes packet captures 
            - useful for incident analysis, esp when correlated with IDS or IPS events, firewall logs
        - provides alerting, reporting, and response capabilities 
        - SIEM dashboards components:
            - sensors 
                - typically software agents 
                - usually placed on environments like cloud infra, remote data centers, etc 
                - gathers data and sends it to the SIEM
            - sensitivity and thresholds
                - set thresholds and filter rules to manage SIEM sensitivity
            - trends
            - alerts and alarms
                - tune alerts so they only alarm on important events
            - log aggregation, correlation, and analysis
                - automated correlation and analysis can match known events and IoC 
            - rules
            - logs
                - firewall logs
                    - provide info about blocked / allowed traffic 
                - application logs
                    - include errors from applications, license checks, installer info, etc
                    - web server logs (requests, IP, etc)
                - endpoint logs
                    - application install logs, system and service logs
                - OS specific logs
                    - failed / successful logins, auth, security, etc
                - IDS/IPS logs
                    - show traffic info 
                - network logs
                    - logs for routers / switches, config changes, traffic info, packets, network flows
                        - network flows can show trends, current problems, and new behaviors
                        - can be seen with NetFlow protocol (Cisco protocol, software driven capability) or sFlow (implemented on many devices)
                        - helpful to see what traffic was sent, where it went, and where it came from
                        - may not show all traffic, since it can take a large amt of network device processing power and storage (may sample the traffic at different rates) 
        - logging protocols and tools
            - syslog
                - in Linux, clients send messages to servers via the syslog protocol
                - then, the syslog server collects and stores logs
            - rsyslog
                - very fast 
                - secure logging w/ TLS 
            - syslog-ng
                - enhanced filtering
                - direct logging to db 
                - support for logs via TCP protected by TLS 
            - NXLog
                - open source syslog centralization and aggregation tool that can parse and generate log files 
                - can send logs to analysis tools and SIEMs
            - systemd manages services and processes in linux; you can use journalctl to view systemd logs
        - metadata
            - email metadata
                - email headers (includes sender / recipient, time, etc)
            - mobile metadata
                - collected by phones 
                - call logs, SMS data, data usage, location
            - web metadata
                - embedded into websites 
                - headers, cookies, SEO
            - file metadata
                - how file was created, when, location of device it was created on
        - other data sources
            - vuln scans 
            - packet captures
            - automated reports
            - dashboards
        - benchmarks 
            - benchmarks will include what logs you should log 
    - reporting and archiving
        - report on log info (identifying trends, provide visibility)
        - archive logs and choose when to delete them 
- mitigation and recovery
    - security orchestration, automation, and response (SOAR)
        - SOAR platforms help mitigate and recovery by helping assess attack surface of an org, state of systems, and where issues may exist 
    - containment, mitigation, and recovery techniques 
        - reconfiguring endpoint security solutions 
            - application allow lists 
            - application deny lists 
            - isolation / quarantine files 
            - monitoring 
                - check if system still has issues or is still compromised 
        - config changes
            - firewall rule changes
            - MDM (mobile device management) changes
                - applying new changes / changing policies
                - remotely wiping devices
                - locating devices
            - DLP (data loss prevention) tool changes
                - can focus on preventing data from leaving the org 
                - detect new types / classifications of data from being sent or shared
            - content filter and URL filtering 
                - ensure certain sites can't be accessed 
                - helps prevent malware from phoning home or going to C2 (command and control) sites 
                - prevent users from responding to phishing attacks 
            - updating / revoking certs
        - removing systems / devices 
            - isolation 
                - move system into a protected space / network 
                - can be removing system from network, moving into an isolation VLAN, changing security rules 
            - containment 
                - leave system in place but prevent further malicious actions 
                - network level containment usually done with firewall rules
                - application and system level containment are more difficult 
            - segmentation
                - place systems with different functions or security levels in different zones / segments of a network
                - during an incident, you can segment infected systems away or move crucial systems to a more protected segment 
    - root cause analysis (RCA)
        - process to identify underlying cause for a compromise and ensuring systemic issues that led to the problem are solved
        - common RCA techniques
            - 5 whys
            - event analysis: examines each event and determine the root cause
            - diagramming cause and effect