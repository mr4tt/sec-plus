## network security

- designing secure networks
	- OSI model
		- Please Do Not Throw Sausage Pizza Away! ![Pasted image 20241021171808](https://github.com/user-attachments/assets/2d372088-e8c0-43c5-a862-f1bdf0d899c6)
		- media layers:
			- layer 1: physical
				- transmit bits that make up network traffic
			- layer 2: data link
				- transmit frames (logical groups of bits)
			- layer 3: network 
				- make networks work properly using addressing, routing, and traffic control schemes
		- host layers:
			- layer 4: transport 
				- reliable data transmission
			- layer 5: session
				- session management like authentication
			- layer 6: presentation
				- encryption and compression
			- layer 7: application
				- human computer interaction
	- infra considerations
		- attack surface: what points an unauthorized user could gain access
			- includes services, management interfaces 
		- device placement: 
			- place devices to secure a zone / network segment, allow them to access certain network segment or VLAN traffic, or placed for capabilities like maximum throughput 
		- security zones
			- network segments that can be separated from less secure zones through logical / physical means 
			- ex: segregated guest networks, internet facing networks 
		- connectivity considerations
			- how does the org connect to the internet, are there redundant connections, how fast the connection is
		- failure modes
			- fail closed: when a security device fails, it will not let any traffic through
			- fail open: when a security device fails, it will let all traffic through
			- network taps: devices that monitor or access traffic
				- active: powered, passive: not powered
				- passive devices can't lose power 
				- can be in line (traffic passes through them, can be modified or stopped) or set up as taps (copies traffic instead of interacting with original network traffic)
	- network design concepts
		- physical isolation (air gap)
			- separate devices so there's no connection between them 
		- logical segmentation
			- done with software or settings 
			- ex: VLANs
				- VLAN tags are applied to packets that are part of a VLAN and systems see them like a physical network segment 
		- high availability (HA)
			- service / system / network to be consistently available w/o downtime
			- solutions for it: clustering, proxies, load balancing 
		- implementing secure protocols
			- ex: use HTTPS over HTTP, SSH instead of Telnet
			- make sure the transport method selected is secure (downgrade attacks and using insecure versions of a protocol can lead to data exposure)
		- reputation services
			- reputation: services and data feeds that track IPs, domains, and hosts that engage in malicious activity
			- allow orgs to block / monitor malicious actors and systems 
		- software defined networking (SDN)
			- uses software based network configs to control networks (LAN)
			- SDNs rely on controllers that manage network devices and configs and centrally manages them 
			- allows networks to be dynamic, can change depending on performance metrics or other settings
		- software defined wide area network (SD-WAN)
			- virtual wide area network design that can combine multiple connectivity services for orgs 
			- commonly used with:
				- multiprotocol label switching (MPLS), 5g, and broadband 
			- lets networks route traffic based on application requirements and controls costs by using less expensive connection methods when possible
		- secure access service edge (SASE)
			- combines VPNs, SDWAN, security tools like firewalls, cloud access security brokers, and zero trust networks to provide secure access for devices regardless of location
			- deployed to ensure endpoints and data in trust are secure
	- network segmentation
		- divide network up, usually based on trust boundaries or functional requirements 
		- ex: VLAN
		- specific implementations of network segmentation
			- screened subnets (DMZs)
				- network zones that contain systems which are exposed to less trusted areas
				- commonly used for web servers / internet facing devices 
			- intranets
				- internal networks for employees 
			- extranets
				- networks set up for external access, usually for partners / customers (not the general public)
	- zero trust
		- presumes theres no trust boundary and no network edge
		- each action someone takes needs to be validated as part of an auth process depending on policy, identity, permissions, etc
		- NIST model:![Pasted image 20241022160218](https://github.com/user-attachments/assets/249de9cf-813d-42c8-addd-c3f228691ae5)
			- subjects
				- users, services, or systems that request access / attempt to use rights
			- policy engines
				- makes policy decisions based on rules and external systems like threat intelligence, identity management, and SIEMs
				- uses trust algo to decide grant / deny / revoke access to a resource 
			- policy administrators 
				- components that establish or remove communication path between subjects and resources 
				- creates session auth tokens / credentials as needed
				- if access is denied, tells the policy enforcement point to end the session
			- policy enforcement points
				- communicate with policy administrators to forward requests from subjects and receive instruction from policy admin to allow or end 
		- control plane components:
			- adaptive identity / adaptive authentication
				- leverages context-based auth based on data points like where the user is logging in from, device, etc
				- can request further identity validation if requirements aren't met 
			- threat scope reduction
				- limit scope of what user can do and what resources a user has access to 
				- relies on principle of least privilege and identity based network segmentation 
			- policy driven access control 
				- rely on policies which are enforced by the policy admin and policy enforcement points 
		- data plane components:
			- implicit trust zones 
				- allow use and movement when subject is authenticated by zero trust policy engine
			- subjects and systems 
				- devices and users seeking access
			- policy enforcement points 
				- same thing as NIST definition
	- network access control (NAC)
		- determines if a system or device should be allowed to connect to a network 
		- can use a software agent installed to perform checks or can run from browser
		- can do things like validate patch levels, security settings, antivirus versions, etc 
		- NAC checks can occur before a device is allowed (preadmission) or after connecting (postadmission)
		- 802.1X: standard for authenticating devices connected to a network 
			- uses centralized authentication using EAP 
			- process: 
				- supplicant (user) connects to network and auth server asks them to identify themselves 
				- they respond, auth process starts
				- if credentials are accepted, the user is allowed access 
			- frequently used for port based authentication or port security, which is used at the network access switch level to authorize ports or leave them unauthorized 
	- port security and port level protections
		- port security lets you limit the number of MAC addresses that can be used on a single port (MAC filtering)
			- prevents problems like MAC spoofing, content addressable memory (CAM) table overflows
			- CAM table maps MAC addresses to IP addresses, allowing a switch to send traffic to the correct port 
				- if it overflows, switches can fail over to broadcasting traffic, making otherwise inaccessible traffic visible on their local port 
		- other port level protections
			- loop prevention
				- detects loops and disables ports to prevent the loops from causing issues 
					- loops can be a cable with both ends plugged into the same switch, firewall plugged in backwards, NICs plugged into diff portions of the same network, and other misconfigs
				- spanning tree protocol (STP) sends BPDU frames with a switch identifier that the switch monitors to prevent loops
			- broadcast storm prevention
				- prevents broadcast packets from being amplified when they traverse a network
				- broadcast storm occurs when a loop causes traffic amplification to occur as switches attempt to figure out where traffic should be sent 
			- bridge protocol data unit (BPDU) guard 
				- protects STP by preventing ports that should not send BPDU messages from sending them (usually switch ports where user devices and servers will be plugged in)
				- not turned on for ports where switches will be connected, since they may need to send BPDU messages 
			- DHCP snooping
				- prevents rogue DHCP servers from handling IP addresses by dropping messages from DHCP servers not on the list of trusted servers 
	- VPNs and remote access
		- VPN is a way to create a virtual network link across a public network that allows the endpoints to act as though they're on the same network
		- 2 major VPN technologies
			- IPSec VPNs
				- operate at layer 3
				- requires a client 
				- can operate in tunnel mode or transport mode
					- tunnel mode: entire packets sent are protected
					- transport mode: IP header is not protected but IP payload is 
			- SSL VPNs
				- uses portal approach or tunnel approach
					- portal approach: accessed via webpage and access services through that connection
				- can be used without a client or specific endpoint configuration
		- VPN implementation decisions: 
			- remote access VPN or site to site VPN?
				- site to site connects one site to another 
			- split tunnel VPN or full tunnel VPN?
				- full tunnel sends all network traffic through the VPN tunnel 
				- split tunnel only sends traffic intended for systems on the remote trusted network through the VPN tunnel
					- uses less bandwidth, but can't be monitored 
	- network appliances and security tools
		- jump servers
			- a secured and monitored system used to provide access to security zones 
			- usually accessed with SSH or RDP 
		- load balancers
			- distribute traffic to multiple systems, provide redundancy, and allow for ease of upgrades and patching
			- they present a virtual IP, which clients send requests to, and the load balancer takes the requests and distributes them to a pool 
			- 2 modes of operation 
				- active/active load balancer 
					- distributes load among multiple online systems
				- active/passive load balancer
					- bring backup systems online if an active system is removed or fails to respond to a health check 
			- scheduling / load balancing algos:
				- round robin
					- sends each request to servers by working through a list 
				- least connection
					- sends traffic to server with fewer number of active connections
				- agent based adaptive balancing 
					- agent monitors load and updates the load balancer's traffic distribution based on agent's reports
				- source IP hashing 
					- uses a hash of source IP to assign traffic (basically randomization using client driven input)
				- weighed algorithms:
					- weighted least connection
						- uses a least connection algorithm combined with predetermined weight value 
					- fixed weight
						- relies on preassigned weight for each server 
					- weighted response time
						- combines server's current response time with a weight value 
		- proxy servers
			- accept and forward requests
			- can filter or modify traffic and cache data 
			- 2 types
				- forward proxies
					- placed between clients and servers 
					- accept requests from clients and send them forward to servers 
					- can be used to anonymize traffic or provide access to resources that might be blocked by IP or geographic location because they can conceal the original client
				- reverse proxies
					- placed between servers and clients
					- help with load balancing and caching of content 
					- clients can query a single system but have traffic load spread to multiple systems / sites
		- web filters
			- centralized proxy devices or agent based tools that allow / block traffic based on content rules 
			- ex: blocking a URL, blocking based on pattern matching, etc 
			- when deployed as hardware or virtual machines, it is a centralized proxy ->0 traffic is routed through it 
			- when deployed as an agent, it is a decentralized proxy -> can operate wherever the device is, doesn't need a network configured to route traffic through the centralized proxy
			- has content categorization for url filtering with common categories, usually used with block rules 
		- data protection
			- use a data loss prevention (DLP) solution to block traffic, send notifications, or encrypt data 
		- intrusion detection and intrusion prevention systems
			- intrusion detection systems (IDS) and intrusion prevention systems (IPS) both detect threats
				- IPSs blocks threats 
			- detection methods
				- signature based
				- anomaly based
					- establishes a baseline for an org / network and flags out of the ordinary behavior
		- firewalls
			- 2 types
				- stateless
					- filter every packet based on data like source / dest ip 
				- stateful 
					- pay attention to state of traffic between systems and make a decision based on the whole traffic flow
			- NGFW (next gen fire wall)
				- usually have deep packet inspection, IPS/IDS, antivirus, etc 
				- usually faster than UTM
			- UTM (unified threat management)
				- usually includes firewall, IDS/IPS, URL filtering VPN 
				- similar to ngfw, but more 'out of the box'
			- web application firewalls (WAFs)
				- devices to intercept, analyze, and apply rules to web traffic 
				- similar to a firewall with a IPS
			- firewalls can also be used to create screened subnets 
				- one interface of the firewall can connect to the internet, another is used to created a secured area, and another is used to create a public area (DMZ)
		- access control lists (ACLs)
			- rules that permit / deny actions 
	- deception and disruption technology
		- tools intended to capture information about attackers and their techniques and to disrupt current attacks 
		- honeypots
			- systems configured to look vulnerable but can monitor everything that happens on it 
		- honeynets
			- group of honeypots set up 
		- honeyfiles
			- a file that has unique, detectable data on it that an attacker is likely to collect
			- if this leaves the network, it shows the system was breached
		- honeytokens
			- attractive data that security professionals can track 
			- these can be entries in databases, files, etc
			- IDS, IPS, DLP can be configured to watch for honeytokens 
	- network security, services, and management
		- out of band management 
			- separate means of accessing the administrative interface so admins can reliably gain access if necessary 
			- this can be a management VLAN or entirely separate physical network for administration 
		- DNS
			- has no auth, but DNSSEC can provide auth for DNS data, allowing DNS queries to be validated 
			- make sure DNS servers are configured correctly to prevent zone transfers, ensure DNS logging is on, and DNS requests to malicious domains are blocked
			- DNS filtering: block malicious domains 
				- uses a list of prohibited domains and replaces the correct response with a different one 
				- helpful against phishing
		- email security 
			- domainkeys identified mail (DKIM)
				- lets orgs add content to messages to identify them as being from their domain
				- signs the body of the message and elements of the header, helping ensure the message is actually from the org it claims to be from 
				- add a DKIM signature header, which can be checked against the public key that's stored in public DNS entries for DKIM enabled orgs 
			- sender policy framework (SPF)
				- allows orgs to publish a list of their authorized email servers 
				- SPF records are added to DNS info for your domain and specify which systems are allowed to send email from that domain 
			- domain-based message authentication reporting and conformance (DMARC)
				- uses SPF and DKIM to determine whether an email message is authentic 
				- DMARC records are published in DNS and can be used to determine whether you should accept a message from a sender
			- email security gateways
				- email security devices designed to filter both outbound and inbound email 
					- usually include phishing protection, email encryption, attachment sandboxing, URL analysis
			- SSL / TLS
				- can encrypt data as its transferred
				- uses ephemeral keys 
					- each connection receives a new, unique key
			- SNMP
				- simple network management protocol is used to monitor and manage network devices 
				- SNMP objects like switches and routers are put into a management information base (MIB)
				- when a device configured to used SNMP encounters an error, it sends a message called an SNMP trap
					- SNMP traps are sent to an SNMP manager to notify it 
					- base set of SNMP traps:
						- coldStart
						- warmStart 
						- linkDown
						- linkUp
						- authenticationFailure
						- egpNeighborLoss
		- monitoring services and systems
			- file integrity monitors
				- detecting changes to files and reporting or restoring them 
				- ex: Tripwire 
				- create signature / fingerprint for a while and monitor it 
			- hardening network devices
				- go read ch 11 again lol
				- protect the mgmt console 
				- physical security 
- secure protocols
	- voice and video
		- HTTP -> HTTPS
		- SIP (session initiation protocol) -> SIPS
		- RTP (real time transit protocol) -> SRTP
	- NTP (network time protocol) ->NTS (not widely adopted tho)
		- relies on TLS for authentication to ensure its from a trusted server
	- email / web
		- HTTPS
		- IMAPS
		- POPS
		- DMARC
		- DKIM
		- SPF
	- file transfer
		- FTP (file transfer protocol) -> HTTPS and SFTP (ssh file transfer protocol) or FTPS (file transfer protocol over ssl)
	- directory services
		- LDAP -> LDAPS
	- remote access tech
		- telnet -> SSH
		- microsoft's RDP 
	- DNS
		- DNSSEC and DNS reputation lists 
	- routing / switching protocol security 
		- BGP (border gateway protocol) lacks security
	- network address allocation
		- DHCP isn't secure
	- ![Pasted image 20241029181229](https://github.com/user-attachments/assets/719cdc18-85e3-4afb-9a01-cda42f2791cd)
	- for the test, know:
		- DNSSEC
			- ensures DNS info is not modified or malicious
			- uses digital signatures to validate 
		- SNMP (simple network management protocol) v3
			- provides authentication of message sources, msg integrity validation, and confidentiality via encryption
		- SSH
			- secure alternative to telnet
			- supports other features like SFTP
		- HTTPS
			- relies on TLS
		- SRTP (secure real time protocol)
			- secure version of real time protocol, which provides audio and video streams via networks
			- uses encryption and authentication
		- LDAPS (secure lightweight directory access protocol)
			- TLS version of LDAP
	- email
		- POP (post office protocol) -> POPS
		- IMAP (internet message access protocol) -> IMAPS
		- S/MIME (secure/multipurpose internet mail extensions) provides ability to encrypt and sign MIME data
			- however, it requires a certificate for users to send / receive messages 
	- file transfer protocols
		- FTP -> FTPS with TLS 
		- SFTP uses SSH to perform FTP-like file transfers 
			- usually chosen bc its easier to get through firewalls, since it only uses the SSH port
	- IPSec (internet protocol security)
		- a suite of security protocols used to encrypt and authenticate IP traffic
		- 2 components include:
			- authentication header (AH)
				- uses hashing and shared secret key to ensure integrity of data 
				- validates senders by authenticating sent IP packets
			- encapsulating security payload (ESP)
				- operates in transport mode or tunnel mode
				- tunnel mode: integrity and auth for entire packet
				- transport mode: only protects payload of packet 
- network attacks
	- on path attacks (aka man in the middle)
		- occur when an attacker causes traffic to be relayed through a system an attacker controls 
		- now, they can eavesdrop or alter communications
		- SSL stripping: when an HTTP request is made for a website, you grab that traffic and pass it through your systems 
		- man in the browser: a variant of on path attacks
			- Trojan is sent to user's browser, which can modify and access info sent / received by the browser
			- defense is usually anti malware 
		- attack indicators: changed network gateways or routes 
	- domain name system attacks
		- domain hijacking
			- changes registration of a domain so the domain's settings and configurations can be changed by an attacker, allowing them to send / receive emails, intercept traffic, etc
			- domains can also be acquired when not properly renewed by the owners 
		- DNS poisoning 
			- can be done with on path attack, where attacker provides a DNS response while pretending to be an authoritative DNS service 
			- can be from vuln in DNS protocol / implementations (but rarer)
			- can involve poisoning the DNS cache on systems 
		- URL redirection
			- most common form is inserting alternate IP addresses into system's hosts file 
				- modified host files can be manually checked or monitored by antimalware
		- domain reputation services 
			- provide info about if a domain is a trusted email sender or sends a lot of spam email 
	- credential replay attacks 
		- form of network attack that requires the attacker to capture valid network data and resend / delay it so the attacker's own use of the data is successful 
		- most common version: resend auth hashes 
			- however, session IDs and encryption help prevent this 
	- malicious code 
		- includes worms, ransomware, viruses, trojans
	- DDoS
		- hard to stop b/c from multiple locations, networks, systems 
		- network DDoS
			- botnets conduct ddos attacks 
			- volume based DDoS attacks
				- sheer amount of traffic causes denial of service 
				- some rely on amplification techniques that leverage flaws or features in protocols to create significantly more traffic than the attacker sends 
				- ex:
					- UDP flood
						- UDP doesn't have a 3 way handshake, so it just sends lots of traffic 
						- UDP isn't rate limited, no handshake, so UDP floods can be conducted with minimal resources 
					- ICMP flood (aka ping floods)
						- normally ICMP is rate limited
						- send massive amts of ICMP packets, with each requesting a response
					- amplified DoS
						- take advantage of protocols that allow a small query to return large results (ex: DNS query)
						- spoofing a system's IP address as part of a query can result in DNS server sending a lot of traffic to the spoofed IP 
					- reflected DoS
						- spoofed IP address causes a legit service to cause the attack, making it harder to know who the attacker is 
			- protocol based DDoS attacks
				- focus on underlying protocols for networking 
				- SYN floods
					- sends first step in 3 way handshake, don't respond to the SYN-ACK response to consume resources to consume resources
				- Ping of Death
					- sending ping packet that's too big (larger than allowed maximum size; MTU) 
				- Smurf attack 
					- leveraged ICMP broadcast msgs with a spoofed sender address, causing systems in the broadcast domain to send traffic to the purported sender 
				- Christmas tree attacks 
					- includes spamming fragmented packages, packets with all TCP flags turned on, etc
